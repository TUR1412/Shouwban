# 变更提案: Infinite Evolution Protocol（视觉系统 + 交互进化 + 功能补强）

## 需求背景
当前项目属于“纯静态多页电商示例站点”，交互逻辑集中在 `scripts/main.js`，样式由 `styles/main.css` 与 `styles/extensions.css` 驱动。随着功能增长（收藏/对比/订单/命令面板/虚拟滚动/诊断等），需要一个更强一致性的视觉系统与更可扩展的交互/状态基座，来支撑“高密度信息 + 高动效 + 高性能（60FPS）”的体验目标。

## 产品分析

### 目标用户与场景
- **目标用户:** 国漫/二次元手办爱好者、轻度电商用户、希望快速浏览与筛选藏品的人群
- **使用场景:** 快速搜索 → 进入详情 → 加入购物车/收藏 → 结算；或大规模列表滚动筛选（含压测模式）
- **核心痛点:** 视觉风格不够统一、交互状态分散、缺少“首屏感知性能”与“可观察性/埋点”能力

### 价值主张与成功指标
- **价值主张:** 以“统一视觉系统 + 渐进增强动效 + 高性能交互”打造国漫级质感界面，并为未来接入真实 API 做好请求层/埋点准备
- **成功指标:**
  - 视觉：毛玻璃/渐变边框/阴影层级一致，关键容器统一呈现
  - 交互：跨页转场在支持/不支持 View Transition 的浏览器均表现自然
  - 感知性能：首屏与切换时具备 Skeleton 占位，避免突兀的空白等待
  - 可扩展：筛选从单一“快速筛选”升级为可组合的“多级筛选”

### 人文关怀
- **可访问性:** 遵循 `prefers-reduced-motion`，减少眩晕风险
- **隐私:** 埋点默认仅本地队列；对用户输入做 hash + 长度统计，避免直接保存原文

## 变更内容
1. **视觉系统重构（Phase 1）**：建立黄金比例字阶/间距 token、12 列响应式栅格、动态阴影层级；为主要 UI 容器注入毛玻璃与动态渐变边框；新增 SVG 路径加载动画与 Skeleton 样式。
2. **交互逻辑进化（Phase 2）**：引入 `StateHub` 统一事件/atom；补齐 Skeleton 首屏占位；新增站内跳转离场动效（WAAPI fallback）。
3. **功能矩阵补强（Phase 3）**：实现“多级智能筛选引擎”（高级筛选 Dialog + pills）；实现“实时搜索预提取”（预取搜索页/详情页/图片）；加入“用户行为埋点”与“HTTP 请求重试 + 缓存”基础设施。

## 影响范围
- **模块:**
  - UI / Styles
  - Runtime JS
  - PWA / Service Worker
- **文件:**
  - `styles/main.css`
  - `styles/extensions.css`
  - `scripts/main.js`
  - `products.html`
  - `category.html`
  - `sw.js`
  - `Task_Status.md`

## 风险评估
- **风险:** 大范围样式注入可能改变页面排版；新增模块可能引入边界条件 bug
- **缓解:**
  - 采用渐进增强：`@supports` + `prefers-reduced-motion` 兜底
  - 尽量保持原有 API/事件不变（兼容 `Utils.dispatchChanged` 与现有模块）
  - 通过 `npm run verify` 做结构/版本一致性校验

