# 变更提案: Quark Overhaul 夸克级重构与业务进化

## 需求背景
当前项目已具备完整的多页面电商原型能力与 PWA 基础，但运行时逻辑集中、视觉体系迭代空间较大，且业务扩展仍以示例级交互为主。为在不破坏核心架构与关键业务流程的前提下，提升可维护性、商业表达力与性能体验，本次执行“原子级重构 + 多维业务增强 + 视觉重塑 + 文档重制”。

## 产品分析

### 目标用户与场景
- **用户群体:** 产品原型设计师、前端工程师、品牌方运营、静态站点部署者
- **使用场景:** 电商展示页搭建、营销落地页迭代、无后端原型演示、PWA 离线体验展示
- **核心痛点:** 运行时逻辑过度集中、业务扩展不成体系、视觉一致性不足、性能优化点分散

### 价值主张与成功指标
- **价值主张:** 在保持“零运行时依赖 + 可直接静态部署”的前提下，提供更真实的电商业务链路、更具竞争力的审美表达与更高可维护性。
- **成功指标:** 核心流程无回归；新增 ≥5 项高价值业务扩展可验证；Lighthouse 关键指标保持或提升；`npm run verify` 与核心单测通过。

### 人文关怀
- 保持可访问性（对比度/动效可降级）与数据隐私（仅本地存储、无外发）。

## 变更内容
1. 运行时模块化重构：在保持入口与核心流程不变的前提下拆分 `scripts/main.js`。
2. 视觉系统重塑：基于现有 Token 扩展，形成更统一的未来感视觉语言。
3. 业务扩展（≥5 项）：库存/预售、组合购、会员等级、订单追踪与售后、关注中心/价格趋势、智能策展推荐。
4. 代码清洗与性能迭代：多轮精简、缓存、渲染路径优化。
5. 工程一致性：PWA 预缓存、版本号、校验脚本同步更新。
6. 双语 README 重制：结构化、可落地、审美强化。

## 影响范围
- **模块:** UI / Styles、Runtime JS、PWA、Tooling、Docs
- **文件:** `styles/main.css`、`styles/extensions.css`、`scripts/main.js`、`scripts/core.js`、`scripts/motion.js`、`scripts/pages/*.js`、`sw.js`、`scripts/validate.mjs`、`scripts/bump-version.mjs`、`README.md`、相关 HTML 页面
- **API:** 无对外 API 变更（静态站点）
- **数据:** `localStorage` 新增/升级若干键（需兼容迁移）

## 核心场景

### 需求: 运行时模块化与性能迭代 (Runtime Refactor)
**模块:** Runtime JS / Tooling
在不改变入口与核心流程的前提下拆分模块，形成可复用运行时能力，并执行多轮性能优化。

#### 场景: 模块化拆分与性能循环
运行时逻辑按领域拆分，热点路径缓存与渲染优化逐轮收敛。
- 预期结果: 关键模块职责清晰，回归风险可控
- 预期结果: 长任务与无效重排显著减少

### 需求: 视觉系统重塑 (Visual System)
**模块:** UI / Styles
建立统一的未来感视觉语言，兼顾可读性、动效与可访问性。

#### 场景: 全站视觉一致性升级
主要页面与组件在新 Token 下保持统一风格与清晰层级。
- 预期结果: 视觉层级与信息密度更清晰
- 预期结果: 保持动效可降级与高对比度可读性

### 需求: 库存与预售节奏 (Inventory Pulse)
**模块:** Runtime JS / UI
引入库存、预售与低库存提示，影响列表/详情/购物车与结算校验。

#### 场景: 低库存与预售提示
商品在列表与详情页展示库存与预售状态，库存不足时限制加购并给出清晰提示。
- 预期结果: 低库存/预售标签一致可见
- 预期结果: 结算时被动校验并提示

### 需求: 组合购与套装优惠 (Bundle Deals)
**模块:** Runtime JS / UI
引入套餐组合与套装折扣，提升客单与可玩性。

#### 场景: 一键加入套装
用户在详情页选择套装并一键加入购物车，折扣按规则生效。
- 预期结果: 套装项在购物车中可拆解/取消
- 预期结果: 折扣与优惠码兼容

### 需求: 会员等级与权益 (Loyalty Tiers)
**模块:** Runtime JS / Account
引入会员等级与权益影响（折扣/免邮/优先预售）。

#### 场景: 结算展示会员权益
用户在结算页看到当前等级与享受的权益，费用计算同步反映。
- 预期结果: 等级升级后自动生效
- 预期结果: 权益可配置

### 需求: 订单追踪与售后 (Order Journey)
**模块:** Runtime JS / Orders
引入订单状态时间轴与售后申请（本地模拟）。

#### 场景: 订单详情时间轴
用户在订单中心查看订单状态时间轴并可发起退换申请。
- 预期结果: 时间轴状态按规则推进
- 预期结果: 售后记录可回溯

### 需求: 关注中心与价格趋势 (Watch Center)
**模块:** Runtime JS / Account
整合收藏、降价提醒、到货提醒与价格趋势。

#### 场景: 关注中心统一管理
用户在会员中心统一管理关注列表与提醒策略，趋势信息可视化展示。
- 预期结果: 关注状态跨页面一致
- 预期结果: 趋势数据可解释

### 需求: 智能策展推荐 (Smart Curation)
**模块:** Runtime JS / Homepage / PDP
基于浏览行为与品类偏好提供智能推荐。

#### 场景: 首页与详情联动推荐
首页/详情页推荐与用户最近浏览和品类偏好一致。
- 预期结果: 推荐与用户行为有可解释逻辑
- 预期结果: 支持无行为时的默认策展

## 风险评估
- **风险:** 深度重构引发回归、PWA 缓存版本不一致、数据迁移丢失
- **缓解:** 分模块拆分、引入数据迁移层、严格运行 `npm run verify` 与相关测试
