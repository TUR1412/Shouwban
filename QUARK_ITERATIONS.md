# Shouwban · 夸克级迭代记录（30 次）

> 目标：用 30 个可回滚的小步迭代，把“纯静态电商模板”打磨到更稳、更安全、更易维护、更可访问的状态。
>
> 说明：每一次迭代尽量只做一个可验证的改动，并保持 `node scripts/validate.mjs` 可通过。

## 迭代清单

| 迭代 | 领域 | 变更摘要 |
| --- | --- | --- |
| 01 | PWA | 导航请求离线时优先返回已缓存页面，再回退 `offline.html` |
| 02 | PWA | 离线时对目录路由（`/.../`）回退到缓存 `index.html` |
| 03 | 工程化 | 校验脚本增强：确保 `sw.js` 的 `PRECACHE_URLS` 覆盖全部 HTML |
| 04 | 体验/健壮 | 结算页监听 `cart:changed`，同标签页购物车变化自动刷新摘要 |
| 05 | 数据一致性 | 新增 `Cart.setCart()` 统一入口（归一化 + 事件派发 + 写入） |
| 06 | 数据一致性 | 商品详情页加入购物车优先走 `Cart.setCart()`，降低分叉逻辑 |
| 07 | 数据一致性 | 结算成功清空购物车优先走 `Cart.setCart([])` |
| 08 | 离线体验 | `offline.html` 增加网络状态提示 + “重试加载”按钮，并由 JS 驱动 |
| 09 | PWA | 修复静态资源离线时可能返回 `null` 的响应问题（改为 504 Response） |
| 10 | PWA | 导航请求增加超时策略（慢网快速回退缓存/离线页） |
| 11 | 可访问性 | 修复 `:focus` 覆盖 `:focus-visible` 导致键盘焦点提示丢失的问题 |
| 12 | 可访问性 | Header 下拉菜单补齐 `aria-*` + 键盘打开（不牺牲 Enter 跳转） |
| 13 | 可访问性 | Header 激活态补齐 `aria-current="page"` |
| 14 | 体验 | 注入“返回顶部”按钮（安全、轻量、尊重减少动态偏好） |
| 15 | 可访问性 | JS 尊重 `prefers-reduced-motion`（平滑滚动/入场动画降级） |
| 16 | 体验 | 商品详情新增“复制链接”分享按钮（Clipboard API + 降级方案） |
| 17 | 体验 | 购物车新增“清空购物车”按钮（确认 + Toast 提示） |
| 18 | 可访问性 | 结算表单错误补齐 `aria-invalid`/`aria-describedby`，并聚焦首个错误 |
| 19 | 可访问性 | Header 搜索补齐 `aria-controls` + `aria-hidden`，打开时自动关闭其它浮层 |
| 20 | 工程化 | Cart 模块不再“非购物车页早退”，全页面统一 API（更稳更一致） |
| 21 | 工具链 | 新增 `scripts/bump-version.mjs`：一键统一 bump HTML/SW/任务看板版本号 |
| 22 | 工具链 | 新增最小 `package.json`（零依赖），提供 `npm run verify` 等脚本入口 |
| 23 | CI | 校验工作流增加 `scripts/bump-version.mjs` 语法检查 |
| 24 | 文档 | 新增 `SECURITY.md`（漏洞披露与安全边界说明） |
| 25 | 文档 | （待完成） |
| 26 | 文档/协作 | （待完成） |
| 27 | 工程化 | （待完成） |
| 28 | 文档美化 | （待完成） |
| 29 | 发布 | （待完成） |
| 30 | 发布 | （待完成） |

