# Shouwban · 夸克级迭代记录（60 次）

> 目标：用 30 个可回滚的小步迭代，把“纯静态电商模板”打磨到更稳、更安全、更易维护、更可访问的状态。
>
> 说明：每一次迭代尽量只做一个可验证的改动，并保持 `node scripts/validate.mjs` 可通过。

## 迭代清单

| 迭代 | 领域 | 变更摘要 |
| --- | --- | --- |
| 01 | PWA | 导航请求离线时优先返回已缓存页面，再回退 `offline.html` |
| 02 | PWA | 离线时对目录路由（`/.../`）回退到缓存 `index.html` |
| 03 | 工程化 | 校验脚本增强：确保 `sw.js` 的 `PRECACHE_URLS` 覆盖全部 HTML |
| 04 | 体验/健壮 | 结算页监听 `cart:changed`，同标签页购物车变化自动刷新摘要 |
| 05 | 数据一致性 | 新增 `Cart.setCart()` 统一入口（归一化 + 事件派发 + 写入） |
| 06 | 数据一致性 | 商品详情页加入购物车优先走 `Cart.setCart()`，降低分叉逻辑 |
| 07 | 数据一致性 | 结算成功清空购物车优先走 `Cart.setCart([])` |
| 08 | 离线体验 | `offline.html` 增加网络状态提示 + “重试加载”按钮，并由 JS 驱动 |
| 09 | PWA | 修复静态资源离线时可能返回 `null` 的响应问题（改为 504 Response） |
| 10 | PWA | 导航请求增加超时策略（慢网快速回退缓存/离线页） |
| 11 | 可访问性 | 修复 `:focus` 覆盖 `:focus-visible` 导致键盘焦点提示丢失的问题 |
| 12 | 可访问性 | Header 下拉菜单补齐 `aria-*` + 键盘打开（不牺牲 Enter 跳转） |
| 13 | 可访问性 | Header 激活态补齐 `aria-current="page"` |
| 14 | 体验 | 注入“返回顶部”按钮（安全、轻量、尊重减少动态偏好） |
| 15 | 可访问性 | JS 尊重 `prefers-reduced-motion`（平滑滚动/入场动画降级） |
| 16 | 体验 | 商品详情新增“复制链接”分享按钮（Clipboard API + 降级方案） |
| 17 | 体验 | 购物车新增“清空购物车”按钮（确认 + Toast 提示） |
| 18 | 可访问性 | 结算表单错误补齐 `aria-invalid`/`aria-describedby`，并聚焦首个错误 |
| 19 | 可访问性 | Header 搜索补齐 `aria-controls` + `aria-hidden`，打开时自动关闭其它浮层 |
| 20 | 工程化 | Cart 模块不再“非购物车页早退”，全页面统一 API（更稳更一致） |
| 21 | 工具链 | 新增 `scripts/bump-version.mjs`：一键统一 bump HTML/SW/任务看板版本号 |
| 22 | 工具链 | 新增最小 `package.json`（零依赖），提供 `npm run verify` 等脚本入口 |
| 23 | CI | 校验工作流增加 `scripts/bump-version.mjs` 语法检查 |
| 24 | 文档 | 新增 `SECURITY.md`（漏洞披露与安全边界说明） |
| 25 | 文档 | 新增 `QUARK_ITERATIONS.md`：记录 30 次迭代的可追溯清单 |
| 26 | 文档 | README 一级美化：补齐脚本入口、安全与迭代记录链接 |
| 27 | 协作 | CONTRIBUTING 补齐 `npm run verify` 与一键 bump 版本号指南 |
| 28 | 文档 | 新增 `TROUBLESHOOTING.md`：缓存/SW/file:// 常见问题排查 |
| 29 | 发布 | 统一 bump 静态资源缓存版本到 `20251218.4`（HTML↔SW 一致） |
| 30 | 文档 | 更新任务看板，汇总本轮“夸克级”修复/升级点与验收方式 |
| 31 | 视觉 | 首页新增 Bento 高亮区，信息模块化展示 |
| 32 | 体验 | 最近浏览模块：PDP 记录 + 首页复盘 |
| 33 | 体验 | 最近浏览空态插画 + CTA 引导 |
| 34 | 体验 | 最近浏览清空按钮 + 禁用态 |
| 35 | 体验 | Header 搜索联想：即时提示商品 |
| 36 | 可访问性 | 搜索建议键盘导航 + `aria-activedescendant` |
| 37 | 体验 | 搜索高亮匹配 + 快捷提示文案 |
| 38 | 体验 | 搜索清除按钮 + ESC 一键清空 |
| 39 | 体验 | 搜索输入优化：`autocomplete` / `enterkeyhint` |
| 40 | 体验 | 搜索建议补充分类/系列信息 |
| 41 | 体验 | 全站滚动进度条（Scroll Progress） |
| 42 | 体验 | 列表/分类/搜索标题显示数量 |
| 43 | 工程化 | 列表排序偏好本地记忆 |
| 44 | 视觉 | 商品卡片角标（NEW / 优惠） |
| 45 | 视觉 | 商品卡片图片 4:5 比例，减少 CLS |
| 46 | 性能 | 图片懒加载 shimmer 占位 |
| 47 | 稳健 | 图片加载失败兜底占位 |
| 48 | 体验 | PDP 主图/缩略图 `decoding` + 懒加载 |
| 49 | 体验 | 购物车数量上限 99 + 按钮禁用 |
| 50 | 体验 | PDP 数量输入上限 99 + 校验 |
| 51 | 可访问性 | 列表/购物车渲染 `aria-live` + `aria-busy` |
| 52 | 表单 | 结算表单自动填充（autocomplete/inputmode） |
| 53 | 表单 | 结算草稿本地保存 + 自动恢复 |
| 54 | 表单 | 结算页一键清空表单 |
| 55 | 可访问性 | 结算摘要 `aria-live` 提示 |
| 56 | PWA | Manifest shortcuts（收藏/购物车/商品） |
| 57 | SEO | 首页 Organization JSON-LD |
| 58 | 体验 | 搜索建议底部键盘提示 |
| 59 | 体验 | 最近浏览跨标签页同步 |
| 60 | 体验 | 搜索建议清空后焦点回归输入框 |
